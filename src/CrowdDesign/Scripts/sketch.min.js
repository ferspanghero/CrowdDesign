var __slice=Array.prototype.slice;(function(n){var t;return n.fn.sketch=function(){var u,r,i;if(r=arguments[0],u=2<=arguments.length?__slice.call(arguments,1):[],this.length>1&&n.error("Sketch.js can only be called on one element at a time."),i=this.data("sketch"),typeof r=="string"&&i)if(i[r]){if(typeof i[r]=="function")return i[r].apply(i,u);if(u.length===0)return i[r];if(u.length===1)return i[r]=u[0]}else return n.error("Sketch.js did not recognize the given command.");else return i?i:(this.data("sketch",new t(this.get(0),r)),this)},t=function(){function t(t,i){this.el=t;this.canvas=n(t);this.context=t.getContext("2d");this.options=n.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},i);this.painting=!1;this.color=this.options.defaultColor;this.size=this.options.defaultSize;this.tool=this.options.defaultTool;this.actions=[];this.action=[];this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent);this.options.toolLinks&&n("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(){var e,r,t,u,i,o,f;for(r=n(this),e=n(r.attr("href")),u=e.data("sketch"),f=["color","size","tool"],i=0,o=f.length;i<o;i++)t=f[i],r.attr("data-"+t)&&u.set(t,n(this).attr("data-"+t));return n(this).attr("data-download")&&u.download(n(this).attr("data-download")),!1})}return t.prototype.download=function(n){var t;return n||(n="png"),n==="jpg"&&(n="jpeg"),t="image/"+n,window.open(this.el.toDataURL(t))},t.prototype.set=function(n,t){return this[n]=t,this.canvas.trigger("sketch.change"+n,t)},t.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}},t.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},t.prototype.onEvent=function(t){return t.originalEvent&&t.originalEvent.targetTouches&&t.originalEvent.targetTouches.length>0&&(t.pageX=t.originalEvent.targetTouches[0].pageX,t.pageY=t.originalEvent.targetTouches[0].pageY),n.sketch.tools[n(this).data("sketch").tool].onEvent.call(n(this).data("sketch"),t),t.preventDefault(),!1},t.prototype.redraw=function(){var t;return this.el.width=this.canvas.width(),this.context=this.el.getContext("2d"),t=this,n.each(this.actions,function(){if(this.tool)return n.sketch.tools[this.tool].draw.call(t,this)}),this.painting&&this.action?n.sketch.tools[this.action.tool].draw.call(t,this.action):void 0},t}(),n.sketch={tools:{}},n.sketch.tools.marker={onEvent:function(n){switch(n.type){case"mousedown":case"touchstart":this.painting&&this.stopPainting();this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}if(this.painting)return this.action.events.push({x:n.pageX-this.canvas.offset().left,y:n.pageY-this.canvas.offset().top,event:n.type}),this.redraw()},draw:function(n){var t,f,i,u,r;for(this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(n.events[0].x,n.events[0].y),r=n.events,i=0,u=r.length;i<u;i++)t=r[i],this.context.lineTo(t.x,t.y),f=t;return this.context.strokeStyle=n.color,this.context.lineWidth=n.size,this.context.stroke()}},n.sketch.tools.text={onEvent:function(t){var r,i,u;switch(t.type){case"mousedown":case"touchstart":if(t.type==="mousedown"&&t.button===0||t.type==="touchstart")if(this.startPainting(),r=document.getElementById("tempTextArea"),r==null)i=n("<textarea>",{type:"text",id:"tempTextArea"}),i.css({position:"absolute",left:t.pageX,top:t.pageY,height:"100px",width:"200px"}),n("body").append(i),i.focus(),i.keyup(function(n){n.which===27&&(n.preventDefault(),document.body.removeChild(this))}),i.focusout(function(){document.body.removeChild(this)});else{t.preventDefault();var o=this.context.measureText("M").width*1.2,s=parseInt(n(r).css("left"))-this.canvas.offset().left,f=parseInt(n(r).css("top"))-this.canvas.offset().top,e=n(r).val().split("\n");for(u=0;u<e.length;u++)this.action.events.push({x:s,y:f,text:e[u],event:t.type}),f+=o;n("#tempTextArea").blur();this.stopPainting()}}},draw:function(n){if(this.context.font="20px Georgia",n.events!=null)for(var t=0;t<n.events.length;t++)this.context.fillText(n.events[t].text,n.events[t].x,n.events[t].y)}},n.sketch.tools.eraser={onEvent:function(t){return n.sketch.tools.marker.onEvent.call(this,t)},draw:function(t){var i;return i=this.context.globalCompositeOperation,this.context.globalCompositeOperation="destination-out",t.color="#000000",n.sketch.tools.marker.draw.call(this,t),this.context.globalCompositeOperation=i}}})(jQuery);
//# sourceMappingURL=sketch.min.js.map
