@{
    ViewBag.Title = "Edit project details";
}
@using System.IdentityModel.Protocols.WSTrust
@using CrowdDesign.UI.Web.Models
@model CrowdDesign.UI.Web.Models.EditProjectViewModel

<div>
    <p id="pPromptTitle">
        <span id="spanProjectTitle"><strong>@Html.DisplayName(Model.Name)</strong></span>
    </p>

    @if (Model.Phase == EditProjectViewModel.EProjectPhase.Sketching)
    {
        <p id="phaseTitle"><strong>Sketching Phase</strong></p>
    }
    else
    {
        <p id="phaseTitle"><strong>Voting Phase</strong></p>
    }

    <div style="margin: 0; padding-bottom: 0;">
        <label>Ready for the voting phase?</label>

        @if (Model.UserProjectVotingEntry != null && Model.UserProjectVotingEntry.Ready)
        {
            <img id="imgProjectReady" class="imgVote" src="~/Content/resources/images/like_selected.png" data-userid=@Model.UserId data-projectid=@Model.ProjectId style="position: absolute; top: 5px;" />
        }
        else
        {
            <img id="imgProjectNotReady" class="imgVote" src="~/Content/resources/images/like.png" data-userid=@Model.UserId data-projectid=@Model.ProjectId style="position: absolute; top: 5px;" />
        }

        @if (Model.Phase == EditProjectViewModel.EProjectPhase.Voting)
        {
            using (Html.BeginForm("GetProjectTopCompleteSolutions", "Project", new {projectId = Model.ProjectId, passingDimensionsIds = Model.Dimensions == null ? null : string.Join(",", Model.Dimensions.Select(e => e.Id).ToArray())}, FormMethod.Post))
            {
                <div style="padding-left: 0; padding-bottom: 0;">
                    <input type="submit" value="Show top voted complete solutions"/>
                </div>
            }
        }
    </div>
</div>

<div>
    <table id="tblMorphChart">
        <thead>
            <tr>
                <th>Decision points</th>
                @if (Model != null && Model.Dimensions != null)
                {
                    int i = 1;

                    if (Model.Dimensions.Any(c => c.Sketches != null && c.Sketches.Count > 0))
                    {
                        int proposedSolutionsCount = (from c in Model.Dimensions
                                                      where c.Sketches != null && c.Sketches.Count > 0
                                                      select c.Sketches.Count()).Max();

                        if (proposedSolutionsCount > 0)
                        {
                            i += proposedSolutionsCount;
                        }
                    }

                    <th id="thSolutionAlternativesTitle" colspan="@i">Solution Alternatives</th>
                }

            </tr>
        </thead>
        <tbody>

            @if (Model == null || Model.Dimensions == null || Model.Dimensions.Count == 0)
            {
                if (Model.Phase == EditProjectViewModel.EProjectPhase.Sketching)
                {
                    <tr>
                        <td>
                            <div class="divDimension">
                                @Html.ActionLink("Add decision point", "EditDimension", "Dimension", new {ProjectId = Model != null ? Model.ProjectId : null}, null)
                                <a class="aPlusButton" href="@Url.Action("EditDimension", "Dimension", new {ProjectId = Model != null ? Model.ProjectId : null}, null)">
                                    <img class="imgPlusIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAABgCAYAAAB7YK6NAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAdVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPjI8L3RpZmY6UGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CrDjMt0AAAF3SURBVHgB7d0xcoMwAEVB4P5nxoaeAhWeJ42XMqPk2eufdJpsm4cAAQIECBAgQIAAAQIECBAgQGBVgX3khX+uZ+T8r88ex7Gd5/nrzOufv1/P68PXwWPk8GxnJ9vCMM/S+MPvdrJvgB9+IPDhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJheugO0XXlaLZrWSHdY/q+s/b6r8kQ/mzy9/2zme5l/dWFuMftLfTF178iC72nZV4q/PCjgg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlh/ir56e559krS7p9RMgQIAAAQIECBAgQIAAAQIrCnwBUVwXibtjKX8AAAAASUVORK5CYII="/>
                                </a>
                            </div>
                        </td>

                        <td></td>

                    </tr>
                }
            }
            else
            {
                foreach (var dimension in Model.Dimensions)
                {
                    bool dimensionVotingEntryExists = Model.UserDimensionVotingEntriesMap.ContainsKey(dimension.Id);

                    <tr>
                        <td class="divDimensionDraggable divDimensionDroppable" data-dimensionid=@dimension.Id>
                            <div class="divDimension">
                                @Html.ActionLink(dimension.Name, "EditDimension", "Dimension", new { ProjectId = Model.ProjectId, DimensionId = dimension.Id }, new { Title = "Sort criteria: " + dimension.SortCriteria })

                                @if (Model.Phase == EditProjectViewModel.EProjectPhase.Sketching)
                                {
                                    if (dimensionVotingEntryExists && Model.UserDimensionVotingEntriesMap[dimension.Id].DownvotedDimension)
                                    {
                                        <img class="imgVote imgDimensionDownvoteSelected" src="~/Content/resources/images/dislike_selected.png" data-userid=@Model.UserId data-dimensionid=@dimension.Id data-projectid=@Model.ProjectId />
                                    }
                                    else
                                    {
                                        <img class="imgVote imgDimensionDownvote" src="~/Content/resources/images/dislike.png" data-userid=@Model.UserId data-dimensionid=@dimension.Id data-projectid=@Model.ProjectId />
                                    }
                                }
                                <p class="pDimensionDescription">
                                    @dimension.Description
                                </p>
                            </div>
                        </td>
                        @if (dimension.Sketches != null)
                        {

                            int amountOfSolutionsInRow = 0;
                            foreach (var sketch in dimension.Sketches)
                            {
                                <td class="divSketchDroppable" data-sketchid=@sketch.Id>
                                    <div class="divSolutionAlternative divSketchDraggable" data-sketchid=@sketch.Id>
                                        <p class="pSolutionTitle">@sketch.Title</p>

                                        @if (Model.Phase == EditProjectViewModel.EProjectPhase.Voting)
                                        {
                                            if (dimensionVotingEntryExists && Model.UserDimensionVotingEntriesMap[dimension.Id].SelectedSketchId != null && Model.UserDimensionVotingEntriesMap[dimension.Id].SelectedSketchId.Value == sketch.Id)
                                            {
                                                <img class="imgVote imgSketchVoteSelected" src="~/Content/resources/images/tick-on.png" data-userid=@Model.UserId data-dimensionid=@dimension.Id data-projectid=@Model.ProjectId />
                                            }
                                            else
                                            {
                                                <img class="imgVote imgSketchVote" src="~/Content/resources/images/tick-off.png" data-userid=@Model.UserId data-dimensionid=@dimension.Id data-projectid=@Model.ProjectId data-sketchid=@sketch.Id />
                                            }
                                        }

                                        <a href=@Url.Action("EditSketch", "Sketch", new {ProjectId = Model.ProjectId, DimensionId = dimension.Id, SketchId = sketch.Id})>
                                            <img id="imgSketchThumbnail" src=@sketch.ImageUri />
                                        </a>
                                    </div>
                                </td>

                                amountOfSolutionsInRow++;
                            }

                            if (Model.Phase == EditProjectViewModel.EProjectPhase.Sketching)
                            {
                                // Add new solution box to the row
                                <td class="tdAddNewSketch divNewSketchDroppable" data-dimensionid="@dimension.Id">
                                    <div class="divSolutionAlternative pSolutionTitle">
                                        @Html.ActionLink("Add solution", "EditSketch", "Sketch", new {ProjectId = Model.ProjectId, DimensionId = dimension.Id}, null)
                                        <a class="aPlusButton" href="@Url.Action("EditSketch", "Sketch", new {ProjectId = Model.ProjectId, DimensionId = dimension.Id}, null)">
                                            <img class="imgPlusIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAABgCAYAAAB7YK6NAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAdVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPjI8L3RpZmY6UGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CrDjMt0AAAF3SURBVHgB7d0xcoMwAEVB4P5nxoaeAhWeJ42XMqPk2eufdJpsm4cAAQIECBAgQIAAAQIECBAgQGBVgX3khX+uZ+T8r88ex7Gd5/nrzOufv1/P68PXwWPk8GxnJ9vCMM/S+MPvdrJvgB9+IPDhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJheugO0XXlaLZrWSHdY/q+s/b6r8kQ/mzy9/2zme5l/dWFuMftLfTF178iC72nZV4q/PCjgg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlh/ir56e559krS7p9RMgQIAAAQIECBAgQIAAAQIrCnwBUVwXibtjKX8AAAAASUVORK5CYII="/>
                                        </a>
                                    </div>
                                </td>
                            }

                            int proposedSolutionsCount = 0;

                            if (Model.Dimensions.Any(c => c.Sketches != null && c.Sketches.Count > 0))
                            {
                                proposedSolutionsCount = (from c in Model.Dimensions
                                                          where c.Sketches != null && c.Sketches.Count > 0
                                                          select c.Sketches.Count()).Max();
                            }

                            // Add an empty cell to make a block
                            for (int i = 0; i < proposedSolutionsCount - amountOfSolutionsInRow; i++)
                            {
                                <td></td>
                            }
                        }
                    </tr>
                }

                <tr>
                    @if (Model.Phase == EditProjectViewModel.EProjectPhase.Sketching)
                    {
                        <td>
                            <div class="divDimension">
                                @Html.ActionLink("Add decision point", "EditDimension", "Dimension", new {ProjectId = Model.ProjectId}, null)
                                <a class="aPlusButton" href="@Url.Action("EditDimension", "Dimension", new {ProjectId = Model.ProjectId}, null)">
                                    <img class="imgPlusIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAABgCAYAAAB7YK6NAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAdVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPjI8L3RpZmY6UGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CrDjMt0AAAF3SURBVHgB7d0xcoMwAEVB4P5nxoaeAhWeJ42XMqPk2eufdJpsm4cAAQIECBAgQIAAAQIECBAgQGBVgX3khX+uZ+T8r88ex7Gd5/nrzOufv1/P68PXwWPk8GxnJ9vCMM/S+MPvdrJvgB9+IPDhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJh2vLhhwJheugO0XXlaLZrWSHdY/q+s/b6r8kQ/mzy9/2zme5l/dWFuMftLfTF178iC72nZV4q/PCjgg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlg8/FAjTlh/ir56e559krS7p9RMgQIAAAQIECBAgQIAAAQIrCnwBUVwXibtjKX8AAAAASUVORK5CYII="/>
                                </a>

                            </div>

                        </td>
                    }

                    @{

                        int emptyCellsNeeded = 0;

                        if (Model.Dimensions.Any(c => c.Sketches != null && c.Sketches.Count > 0))
                        {
                            emptyCellsNeeded = (from c in Model.Dimensions
                                where c.Sketches != null && c.Sketches.Count > 0
                                select c.Sketches.Count()).Max();
                        }

                        //add an empty cell to make a block
                        for (int i = 0; i <= emptyCellsNeeded; i++)
                        {
                            <td></td>
                        }

                    }
                </tr>
            }
        </tbody>
    </table>

    @*this is put here because when loading the page it seems to be visable for a second*@
    <div id="prompt" title="Design Prompt">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam consectetur, nibh sed volutpat efficitur, odio ligula laoreet augue, eu sodales tortor quam id lectus. Duis non nunc ultrices, tristique quam vitae, malesuada nibh. Sed sodales, lectus ut fermentum congue, ipsum ipsum mattis libero, vel tristique turpis mauris at nisl. Integer dignissim, magna sed sodales faucibus, ipsum sem commodo justo, in sagittis diam risus nec metus. Vestibulum vulputate interdum risus sit amet lacinia. Ut mauris augue, pulvinar a ipsum ut, ultrices malesuada ante. Etiam vel mauris tortor. Proin egestas facilisis sapien vel viverra. Nullam sit amet nibh ac odio dictum pretium. Mauris quis mattis mi, eu accumsan justo. Curabitur a nibh suscipit justo fermentum aliquet sodales eget ex. Quisque gravida non arcu tempor condimentum. Morbi eleifend blandit lobortis. Suspendisse ac dui cursus, feugiat lacus ac, finibus est. Mauris egestas erat sit amet eros ornare luctus. Phasellus consectetur est quam, at ultrices felis porttitor nec.</p>
    </div>

</div>

<div id="divMergeConfirmationDialog" title="Merge the dimensions?">
    <p>This operation cannot be undone. Are you sure you want to continue?</p>
</div>

@section scripts
{
    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/Scripts/jquery.unobtrusive-ajax.js")
    @Scripts.Render("~/Scripts/Custom/EditProject.js")
    @Scripts.Render("~/Scripts/jquery.signalR-2.2.0.js")
    @Scripts.Render("~/signalr/hubs")
}
